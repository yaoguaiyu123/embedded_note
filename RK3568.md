# å‰è¨€

ç¡¬ä»¶è®¾å¤‡ï¼šæ­£ç‚¹åŸå­RK3568å¼€å‘æ¿

https://www.bilibili.com/video/BV1AP411s7iN/

**ä¸¥ç¦å¸¦ç”µæ’æ‹”**ï¼šç»å¯¹ä¸è¦åœ¨æ¿å­é€šç”µï¼ˆè“è‰²ç¯äº®ï¼‰çš„æƒ…å†µä¸‹æ’æ‹”æ‘„åƒå¤´ã€å±å¹•æ’çº¿ã€è·³çº¿å¸½ç­‰å¤–è®¾ ã€‚è¿™ææ˜“å¯¼è‡´æ¥å£èŠ¯ç‰‡çƒ§æ¯ã€‚å¦‚æœéœ€è¦æ¥çº¿ï¼Œè¯·å…ˆæŒ‰ ON/OFF é”®æ–­ç”µï¼Œç­‰ç¯ç­äº†å†æ“ä½œ

![image-20251231091554400](.\assets\image-20251231091554400.png)

# ç»™æ¿å­ä¸Šç”µ

- ä½¿ç”¨ HDMI çº¿è¿æ¥å¼€å‘æ¿ä¸æ˜¾ç¤ºè®¾å¤‡ï¼ˆå½“å‰ä½¿ç”¨æ”¯æŒ HDMI è¾“å…¥çš„å¹³æ¿ä½œä¸ºæ˜¾ç¤ºå™¨ï¼‰

- ç”±äºæˆ‘çš„å¹³æ¿é‡‡ç”¨è½¯ä»¶æ˜¾ç¤ºï¼Œæ— è§¦æ‘¸å±åŠŸèƒ½ï¼Œæ‰€ä»¥å°† USB é¼ æ ‡æ’å…¥å¼€å‘æ¿å·¦ä¸‹è§’çš„ **USB** æ¥å£ï¼Œç”¨äºç³»ç»Ÿæ“ä½œ

- ä½¿ç”¨å¥—ä»¶è‡ªå¸¦çš„ **12V/2.5A** ç”µæºé€‚é…å™¨ ã€‚å…ˆå°†æ’å¤´æ’å…¥æ’æ’ï¼Œå†å°† DC åœ†å£æ’å…¥å¼€å‘æ¿å³ä¸Šè§’çš„ç”µæºæ¥å£ 

- æŒ‰ä¸‹ç”µæºæ¥å£ä¸‹æ–¹çš„ **ON/OFF** è‡ªé”å¼€å…³ï¼Œè“è‰²ç”µæºç¯å¸¸äº®ï¼Œç­‰å¾…ç³»ç»Ÿå¯åŠ¨

# æ¿å­å…³æœº

- åœ¨ä¸²å£ç»ˆç«¯è¾“å…¥å‘½ä»¤ï¼š`poweroff`

- æ‹¨åŠ¨ ON/OFF å¼€å…³
- æ‹”ä¸‹ 12V ç”µæºçº¿
- æ‹”ä¸‹HDMI çº¿ã€USB......



# çƒ§å…¥ Linux (Buildroot) é•œåƒ

> å…·ä½“æ­¥éª¤è§ã€Š03ã€æ­£ç‚¹åŸå­ã€‘ATK-DLRK3568å‡ºå‚é•œåƒçƒ§å½•æŒ‡å¯¼V1.2.pdfã€‹
> æˆ‘çš„æ¿å­å‡ºå‚å°±æ˜¯ Linux (Buildroot)é•œåƒï¼Œä½†æ˜¯æˆ‘è¯¯ä»¥ä¸ºæ˜¯Androidï¼Œçƒ§å½•å®Œæ‰å‘ç°

- è¿è¡Œ `DriverAssitant` å®‰è£… Rockchip USB é©±åŠ¨ï¼Œç¡®è®¤è¯†åˆ«è®¾å¤‡

- æ‰“å¼€ **RKDevTool** (ç‘èŠ¯å¾®å¼€å‘å·¥å…·)

- Type-C æ•°æ®çº¿ï¼Œä¸€å¤´æ’ç”µè„‘ USBï¼Œå¦ä¸€å¤´æ’å¼€å‘æ¿å·¦ä¾§çš„ **OTG** æ¥å£
- åœ¨ RKDevTool ä¸­ç‚¹å‡»â€œå›ºä»¶â€ï¼Œé€‰æ‹© **`update(HDMI+MIPI).img`**ã€‚é€‰æ‹©æ­¤é•œåƒæ—¢æ”¯æŒå½“å‰çš„ HDMI æ˜¾ç¤ºï¼Œä¹Ÿå…¼å®¹æœªæ¥å¯èƒ½è´­ä¹°çš„ MIPI å°å± 

- è®©å¼€å‘æ¿è¿›å…¥ Loader æ¨¡å¼ï¼šæŒ‰ä½Loaderä¸æ¾ï¼Œç„¶åæŒ‰ä¸€ä¸‹å¤ä½ï¼Œè®©æ¿å­è¿›å…¥åˆ°Loaderæ¨¡å¼

- çƒ§å½•é•œåƒ

# PCç»ˆç«¯è¿æ¥å¼€å‘æ¿è°ƒè¯•ä¸²å£

ä½¿ç”¨ **USB-typeC** è¿æ¥æ¿å­çš„UARTå’Œç”µè„‘çš„USB

![image-20251231104841800](.\assets\image-20251231104841800.png)

# PC Ubuntu20ä¸‹å®‰è£…Qt

> å‚è€ƒã€Š09ã€æ­£ç‚¹åŸå­ã€‘ATK-DLRK3568_Qtå¼€å‘ç¯å¢ƒæ­å»ºV1.2.pdfã€‹

## Ubuntu20

> ä¹‹å‰ä¸€ç›´ç”¨çš„æ˜¯Ubuntu24ï¼Œä½¿ç”¨VirtualBoxæ–°è£…ä¸€ä¸ªUbuntu20

### è¸©å‘è®°å½•

**å®‰è£…å¢å¼ºåŠŸèƒ½æ²¡æœ‰å¼¹å‡º terminal**

- å‘ç°æ˜¯ terminal åäº†ï¼Œè¿›å…¥ `Ctrl` + `Alt` + `F3` ä¿®å¤
- åˆ é™¤ä¹‹å‰å®‰è£…åˆ°ä¸€åŠçš„å¢å¼ºåŠŸèƒ½ï¼Œé‡è£…å¢å¼ºåŠŸèƒ½

**å…±äº«æ–‡ä»¶å¤¹æ²¡æœ‰æƒé™ï¼Œå‘ç°æ˜¯ç”¨æˆ·æƒé™ä¸å¤Ÿ**

- å¼€æœºå‰ç‹‚æŒ‰ `ESC` è¿›å…¥ä¸Šå¸æ¨¡å¼ä¿®æ”¹ç”¨æˆ·æƒé™
- ä¿®æ”¹å…±äº«æ–‡ä»¶å¤¹æƒé™

### Vritualboxå…¨å±æ¨¡å¼

è¿›å…¥å…¨å±æ¨¡å¼ä¹‹å ==Right Ctrl + F== è¿”å›

## Qtå®‰è£…å˜åŒ–

**ä»¥å‰ (Qt 5.14 åŠæ›´æ—©)**

- ç¦»çº¿å®‰è£…ï¼Œå»å®˜ç½‘ä¸‹è½½ä¸€ä¸ªå‡  GB çš„ `.run` æˆ– `.exe` å¤§åŒ…

**ç°åœ¨ (Qt 5.15 åŠ Qt 6)**

- åœ¨çº¿å®‰è£…ï¼Œå®˜ç½‘åªæä¾›ä¸€ä¸ªå‡ å MB çš„å°å®‰è£…å™¨ï¼ˆ`qt-unified-...-online.run`ï¼‰ã€‚éœ€è¦è¿è¡Œå®ƒï¼Œæ³¨å†Œå¹¶ç™»å½• Qt è´¦å·ï¼Œç„¶åå®ƒæ‰ä¼šè”ç½‘ä¸‹è½½ä½ éœ€è¦çš„æ•°æ®åŒ…ï¼Œå®˜æ–¹çš„ç¦»çº¿åŒ…ç°åœ¨åªæä¾›ç»™ä»˜è´¹çš„å•†ä¸šç”¨æˆ·äº†
- å¯åŠ¨å®‰è£…å™¨çš„æ—¶å€™åŠ ä¸Š==é˜¿é‡Œäº‘é•œåƒ==ï¼š./qt-online-installer-linux-x64-4.10.0.run --mirror https://mirrors.aliyun.com/qt

# Ubuntu20ä¸Šå®‰è£…äº¤å‰ç¼–è¯‘å·¥å…·é“¾

> å‚è€ƒã€Š09ã€æ­£ç‚¹åŸå­ã€‘ATK-DLRK3568_Qtå¼€å‘ç¯å¢ƒæ­å»ºV1.2.pdfã€‹
>
> å‚è€ƒã€Š33ã€æ­£ç‚¹åŸå­ã€‘åŸºäºBuildrootç³»ç»Ÿ_äº¤å‰ç¼–è¯‘å™¨å®‰è£…ä¸ä½¿ç”¨å‚è€ƒæ‰‹å†ŒV1.0.pdfã€‹

- **æˆ‘çš„ rk3568 ä¸Šçš„ linux å†…æ ¸æ˜¯ 4.19.232 æ‰€ä»¥é€‰æ‹©**

```bash
atk-dlrk3568-toolchain-arm-buildroot-linux-gnueabihf-x86_64-20230921-v1.0.1.run
```

- **å®‰è£…çš„è¾“å‡º**

```bash
vboxuser@Ubuntu20:~/shared_folder$ ./atk-dlrk3568-toolchain-arm-buildroot-linux-gnueabihf-x86_64-20230921-v1.0.1.run
ATK-DLRK356X toolchain installer version 1.0.1 Generated by Buildroot!
======================================================================
Enter target directory for toolchain (default: /opt/atk-dlrk356x-toolchain): 
You are about to install the toolchain to "/opt/atk-dlrk356x-toolchain". Proceed[Y/n]? 
[sudo] password for vboxuser: 
Extracting toolchain........................................................................................done
Relocating the toolchain to /opt/atk-dlrk356x-toolchain...
Toolchain has been successfully set up and is ready to be used.
Each time you wish to use the Toolchain in a new shell session, you need to source the environment setup script e.g.
 $ . export PATH=$PATH:/opt/atk-dlrk356x-toolchain/usr/bin
```

- **é…ç½®ç¼–è¯‘å™¨å…¨å±€ç¯å¢ƒå˜é‡**

```bash
echo 'export PATH=$PATH:/opt/atk-dlrk356x-toolchain/usr/bin' >> ~/.bashrc
source ~/.bashrc
```

- **è·å–ç¼–è¯‘å™¨åç§°**

```bash
vboxuser@Ubuntu20:~/shared_folder$  ls /opt/atk-dlrk356x-toolchain/usr/bin/*gcc
/opt/atk-dlrk356x-toolchain/usr/bin/aarch64-buildroot-linux-gnu-gcc
/opt/atk-dlrk356x-toolchain/usr/bin/aarch64-linux-gcc
```

è¾“å‡ºä¸¤ä¸ªåç§°ï¼Œä½†æ˜¯å®é™…ä¸Š`aarch64-linux-gcc` æ˜¯ `aarch64-buildroot-linux-gnu-gcc` çš„è½¯é“¾æ¥

- **éªŒè¯ç¼–è¯‘å™¨ç‰ˆæœ¬**

```bash
 aarch64-linux-gcc -v
```

æ‰“å°è¾“å‡ºå¦‚ä¸‹ï¼Œå…¶ä¸­ `gcc` æ˜¯ 10.3.0

```bash
ä½¿ç”¨å†…å»º specsã€‚
COLLECT_GCC=/opt/atk-dlrk356x-toolchain/bin/aarch64-linux-gcc.br_real
COLLECT_LTO_WRAPPER=/opt/atk-dlrk356x-toolchain/bin/../libexec/gcc/aarch64-buildroot-linux-gnu/10.3.0/lto-wrapper
ç›®æ ‡ï¼šaarch64-buildroot-linux-gnu
é…ç½®ä¸ºï¼š./configure --prefix=/home/alientek/ATK-DLRK3568/buildroot/output/rockchip_rk3568/host --sysconfdir=/home/alientek/ATK-DLRK3568/buildroot/output/rockchip_rk3568/host/etc --enable-static --target=aarch64-buildroot-linux-gnu --with-sysroot=/home/alientek/ATK-DLRK3568/buildroot/output/rockchip_rk3568/host/aarch64-buildroot-linux-gnu/sysroot --enable-__cxa_atexit --with-gnu-ld --disable-libssp --disable-multilib --disable-decimal-float --with-gmp=/home/alientek/ATK-DLRK3568/buildroot/output/rockchip_rk3568/host --with-mpc=/home/alientek/ATK-DLRK3568/buildroot/output/rockchip_rk3568/host --with-mpfr=/home/alientek/ATK-DLRK3568/buildroot/output/rockchip_rk3568/host --with-pkgversion='Buildroot 2018.02-rc3-g30e3a128' --with-bugurl=http://bugs.buildroot.net/ --without-zstd --disable-libquadmath --disable-libquadmath-support --enable-tls --enable-threads --without-isl --without-cloog --with-abi=lp64 --with-cpu=cortex-a55 --enable-languages=c,c++ --with-build-time-tools=/home/alientek/ATK-DLRK3568/buildroot/output/rockchip_rk3568/host/aarch64-buildroot-linux-gnu/bin --enable-shared --disable-libgomp
çº¿ç¨‹æ¨¡å‹ï¼šposix
Supported LTO compression algorithms: zlib
gcc ç‰ˆæœ¬ 10.3.0 (Buildroot 2018.02-rc3-g30e3a128) 

```

# å‘½ä»¤è¡Œäº¤å‰ç¼–è¯‘Qté¡¹ç›®ï¼ˆqmakeï¼‰

> è§ã€Š09ã€æ­£ç‚¹åŸå­ã€‘ATK-DLRK3568_Qtå¼€å‘ç¯å¢ƒæ­å»ºV1.2.pdfã€‹

```bash
# æŸ¥çœ‹qmakeç‰ˆæœ¬
/opt/atk-dlrk356x-toolchain/usr/bin/qmake -v

```



# QtCreateräº¤å‰ç¼–è¯‘Qté¡¹ç›®ï¼ˆqmakeï¼‰

> è§ã€Š09ã€æ­£ç‚¹åŸå­ã€‘ATK-DLRK3568_Qtå¼€å‘ç¯å¢ƒæ­å»ºV1.2.pdfã€‹

## å‘½åè§„åˆ™

é…ç½® `Kits` çš„æ—¶å€™å‘ç°çš„å‘½åè§„åˆ™

| **åå­—**             | **å…¨ç§° / å«ä¹‰**             | **é‡Œçš„å­—æ¯ä»£è¡¨ä»€ä¹ˆï¼Ÿ**               |
| -------------------- | --------------------------- | ------------------------------------ |
| **GCC** (å¤§å†™é¡¹ç›®å) | GNU Compiler **Collection** | **C** = **Collection** (é›†åˆ/å…¨å®¶æ¡¶) |
| **gcc** (å°å†™å‘½ä»¤)   | GNU **C** Compiler          | **c** = **C Language** (Cè¯­è¨€)       |
| **g++** (å°å†™å‘½ä»¤)   | GNU **C++** Compiler        | **++** = **C++ Language** (C++è¯­è¨€)  |

## åˆ‡æ¢æ„å»ºå¥—ä»¶

ç‚¹å‡»å·¦ä¸‹è§’çš„ğŸ–¥ï¸æŒ‰é’®è¿›è¡Œåˆ‡æ¢

![image-20260101071708069](.\assets\image-20260101071708069.png)

# è¿œç¨‹éƒ¨ç½²

## RK3568 å¼€å‘æ¿ WiFi è”ç½‘ï¼ˆæ‰‹æœºçƒ­ç‚¹ç‰ˆï¼‰

**å½“å‰ç¯å¢ƒï¼š** æ²¡ç½‘çº¿ï¼Œä¹Ÿæ²¡è·¯ç”±å™¨ã€‚ æ€è·¯ï¼šè®©ç”µè„‘ã€å¹³æ¿ã€å¼€å‘æ¿å…¨éƒ½è¿æˆ‘æ‰‹æœºçƒ­ç‚¹ï¼Œç»„æˆä¸€ä¸ªå±€åŸŸç½‘

**é‡åˆ°çš„å‘ï¼š** åˆšå¼€å§‹æ­»æ´»è¿ä¸ä¸Šï¼ŒæŠ¥é”™ `Operation not possible due to RF-kill`ã€‚ æŸ¥äº†ä¸‹æ˜¯å› ä¸ºç³»ç»Ÿä¸ºäº†çœç”µï¼Œé»˜è®¤å¼€æœºæŠŠ WiFi ç»™â€œè½¯é”æ­»â€äº†ï¼ˆç±»ä¼¼é£è¡Œæ¨¡å¼ï¼‰ï¼Œå¿…é¡»å…ˆæ‰‹åŠ¨è§£é”ï¼

**æ“ä½œæµç¨‹ï¼š**

- **å‡†å¤‡å·¥ä½œ**ï¼šå…ˆæŠŠå¤©çº¿æ‹§ä¸Šï¼ˆæ¥ WIFI_ANT1ï¼‰ï¼Œ

- **æ”¹é…ç½®**ï¼š `vi /etc/wpa_supplicant.conf` å¡«å…¥æ‰‹æœºçƒ­ç‚¹è´¦å·å¯†ç 

    ```bash
    network={
       ssid="GOOD"
       psk="66668888"
       key_mgmt=WPA-PSK
    }
    ```

- **è§£é” & è¿æ¥**ï¼š

    ```bash
    # è§£é™¤çœç”µé”å®š
    rfkill unblock all
    
    # æ¸…ç†æ—§è¿›ç¨‹
    killall wpa_supplicant  
    
    # è¿æ¥
    wpa_supplicant -B -i wlan0 -c /etc/wpa_supplicant.conf  
    
    # æŸ¥çœ‹IP
    udhcpc -i wlan0   
    ```

- **æ£€æŸ¥çŠ¶æ€**

    ```bash
    # æŸ¥çœ‹IP
    ifconfig wlan0  
    ping baidu.com
    ```

### å°†ä¸Šè¿°æ­¥éª¤å†™ä¸ºä¸€ä¸ªå¼€æœºè‡ªå¯åŠ¨çš„è„šæœ¬

```bash
vi /etc/init.d/S99wbywifi
```



## QtCreateré…ç½®è¿œç¨‹è®¾å¤‡

> è§ã€Š09ã€æ­£ç‚¹åŸå­ã€‘ATK-DLRK3568_Qtå¼€å‘ç¯å¢ƒæ­å»ºV1.2.pdfã€‹

## éƒ¨ç½²ä¹‹åï¼ˆ==å°è¯•åŸºäºWestonæ˜¾ç¤ºï¼Œå¤±è´¥ï¼Œæ— æ³•å…¨å±==ï¼‰

>  æ­£ç‚¹åŸå­å‡ºå‚è‡ªå¸¦äº†ä¸€ä¸ªâ€œæ‰‹æœºæ¡Œé¢â€ï¼ˆSystemUIï¼‰ï¼Œè¿è¡Œåœ¨ Westonï¼ˆWayland åˆæˆå™¨ï¼‰ä¹‹ä¸Šï¼Œæˆ‘çš„ç¨‹åºå¹¶æ²¡æœ‰ç‹¬å 

### ç¦ç”¨åŸå‚å¯åŠ¨è„šæœ¬

è¿›å…¥å¯åŠ¨è„šæœ¬ç›®å½•ï¼Œå°†åŸå‚ç•Œé¢çš„è„šæœ¬æ”¹åï¼ˆä½¿å…¶ä¸ä»¥ `S` å¼€å¤´ï¼‰ï¼Œä»è€Œå®ç°ç¦ç”¨ã€‚

```bash
cd /etc/init.d/
mv S50systemui off_S50systemui   # ç¦ç”¨ SystemUI (æ‰‹æœºç•Œé¢)
```

### åŠ å…¥æˆ‘çš„è„šæœ¬

```bash
vi S99wbyapp
```

### è„šæœ¬å†…å®¹å¦‚ä¸‹

```
#!/bin/sh
#
# Start MotoDashboard (Robust Wayland Client Mode)
#

# å®šä¹‰ç¨‹åºè·¯å¾„å’Œ socket è·¯å¾„
APP_PATH="/opt/demo01/bin/demo01"
SOCKET_DIR="/run"
SOCKET_FILE="wayland-0"

case "$1" in
  start)
    echo "Starting Moto Dashboard..."

    # ==========================================
    # 1. æ ¸å¿ƒé˜²å¾¡ï¼šç­‰å¾… Weston å°±ç»ª (æœ€å¤šç­‰ 10 ç§’)
    # ==========================================
    # åˆšåˆšçƒ§å½•å®Œçš„ç³»ç»Ÿï¼Œç¬¬ä¸€æ¬¡å¯åŠ¨ Weston å¯èƒ½ä¼šæ…¢ä¸€ç‚¹
    # æˆ‘ä»¬è¿™é‡Œå†™ä¸ªå¾ªç¯ï¼Œæ­»ç­‰ /run/wayland-0 å‡ºç°
    
    count=0
    while [ ! -e "$SOCKET_DIR/$SOCKET_FILE" ]; do
        if [ $count -gt 50 ]; then
            echo "Error: Weston socket not found after 10s, giving up."
            exit 1
        fi
        echo "Waiting for Wayland socket..."
        sleep 0.2
        count=$((count+1))
    done

    echo "Wayland socket found! Launching..."

    # ==========================================
    # 2. è®¾ç½®ç¯å¢ƒå˜é‡
    # ==========================================
    export QT_QPA_PLATFORM=wayland
    export XDG_RUNTIME_DIR=$SOCKET_DIR
    export WAYLAND_DISPLAY=$SOCKET_FILE
    
    # è¿™ä¸€è¡Œæ˜¯ä¸ºäº†é˜²æ­¢æœ‰äº› QT ç¨‹åºå­—ä½“å‘è™šï¼Œå¯é€‰
    export QT_SCALE_FACTOR=1 

    # ==========================================
    # 3. å¯åŠ¨ç¨‹åº (å¸¦â€œé˜²å¼¹è¡£â€)
    # ==========================================
    # > /dev/null 2>&1 &  <-- è¿™æ˜¯ä¿å‘½ç¬¦ï¼Œç¡®ä¿åå°è¿è¡Œä¸”ä¸æ±¡æŸ“ç»ˆç«¯
    if [ -x "$APP_PATH" ]; then
        $APP_PATH > /dev/null 2>&1 &
        echo "Moto Dashboard started."
    else
        echo "Error: Application not found at $APP_PATH"
    fi
    ;;

  stop)
    echo "Stopping Moto Dashboard..."
    killall -q demo01
    ;;

  restart|reload)
    "$0" stop
    sleep 1
    "$0" start
    ;;

  *)
    echo "Usage: $0 {start|stop|restart}"
    exit 1
esac

exit 0
```

### æ·»åŠ æ‰§è¡Œæƒé™

````bash
chmod +x /etc/init.d/S99wbyapp
````

### å‘ç°UIè¿˜æ˜¯è¢«é™åˆ¶ï¼ˆ==è¿˜æœªæ”¹å›æ¥==ï¼‰

`/etc/xdg/weston/weston.ini`æ–‡ä»¶

```
[core]
backend=drm-backend.so

# Allow running without input devices
require-input=false

# Disable screen idle timeout by default
idle-time=0

# The repaint-window is used to calculate repaint delay(ms) after flipped.
#   value <= 0: delay = abs(value)
#   value > 0: delay = vblank_duration - value
repaint-window=-1

# Allow blending with lower drm planes
# gbm-format=argb8888

[shell]
# top(default)|bottom|left|right|none, none to disable panel
panel-position=none

# Scale panel size
panel-scale=3

# none|minutes(default)|minutes-24h|seconds|seconds-24h
# clock-format=minutes-24h
clock-with-date=false

# Disable screen locking
locking=false

[libinput]
# Uncomment below to enable touch screen calibrator(weston-touch-calibrator)
# touchscreen_calibrator=true
# calibration_helper=/bin/weston-calibration-helper.sh

[keyboard]
# Comment this to enable vt switching
vt-switching=false

# Configs for auto key repeat
# repeat-rate=40
# repeat-delay=400

# [output]
# name=LVDS-1
# transform=rotate-90
```

ä¿®æ”¹ä¸º

```
[core]
backend=drm-backend.so
require-input=false
idle-time=0
repaint-window=-1

[shell]
panel-position=none
panel-scale=3
clock-with-date=false
locking=false

[keyboard]
vt-switching=false

[output]
mode=preferred
transform=normal

```

## éƒ¨ç½²ä¹‹åï¼ˆåŸºäºEGLFS æ˜¾ç¤ºï¼‰

```
cd /etc/init.d/
vi S99wbyapp
```

### S99wbyapp

```
root@ATK-DLRK3568:/etc/init.d# cat ./S99mydashboard
#!/bin/sh
#
# Start MotoDashboard
#

case "$1" in
  start)
    echo "Starting Moto Dashboard..."

    # 1. åŸºç¡€ç¯å¢ƒå˜é‡
    # å‘Šè¯‰ Qt ä½¿ç”¨ eglfs æ’ä»¶ï¼Œç›´æ¥æ¥ç®¡å±å¹•
    export QT_QPA_PLATFORM=eglfs
    # éšè—é¼ æ ‡æŒ‡é’ˆ
    export QT_QPA_EGLFS_HIDECURSOR=1

    # 2. ä¿®å¤æ—¥å¿—é‡Œçš„ QStandardPaths è­¦å‘Š
    # ç»™ Qt æŒ‡å®šä¸€ä¸ªå¯å†™çš„ä¸´æ—¶ç›®å½•ï¼Œæ¶ˆé™¤ runtime directory æŠ¥é”™
    export XDG_RUNTIME_DIR=/tmp/runtime-root
    mkdir -p $XDG_RUNTIME_DIR
    chmod 700 $XDG_RUNTIME_DIR

    # 3. åå°è¿è¡Œä½ çš„ç¨‹åº
    /opt/MotoDashboard/bin/MotoDashboard &
    ;;

  stop)
    echo "Stopping Moto Dashboard..."
    killall MotoDashboard
    ;;

  restart|reload)
    "$0" stop
    "$0" start
    ;;

  *)
    echo "Usage: $0 {start|stop|restart}"
    exit 1
esac

exit 0
root@ATK-DLRK3568:/etc/init.d#

```

## QtCreaterçªç„¶éƒ¨ç½²å¤±è´¥

- å»â€œå·¥å…·-å¤–éƒ¨-é…ç½®-è®¾å¤‡â€é‡Œé¢é‡è·‘ä¸€æ¬¡è¯¥è®¾å¤‡çš„æµ‹è¯•



# å¼€å‘æ¿ä¸Šçš„è“ç‰™æœåŠ¡

**è“ç‰™åè®®ï¼š** Ready (BlueZ 5 + PulseAudio Modules)

```bash
# æ£€æŸ¥è“ç‰™æ˜¯å¦åœ¨è¿è¡Œ
bluetoothctl show              # Powered: yes

# æŸ¥çœ‹è“ç‰™é…å¯¹çš„æ‰€æœ‰è®¾å¤‡
bluetoothctl devices

# æŸ¥çœ‹è“ç‰™å·²è¿æ¥çš„æ‰€æœ‰è®¾å¤‡
bluetoothctl list

# æŸ¥çœ‹è“ç‰™å·²è¿æ¥çš„è®¾å¤‡å’Œå¼€å‘æ¿çš„ä¸»ä»å…³ç³»
hcitool con
```



# å¼€å‘æ¿ä¸Šçš„éŸ³é¢‘æœåŠ¡

**éŸ³é¢‘ä¸­æ¢ï¼š** Ready (PulseAudio 14.2) 

```bash
# æŸ¥çœ‹å½“å‰è“ç‰™è€³æœºçš„éŸ³é‡
pactl list sinks | grep -A 10 "bluez_sink.11_02_03_06_13_5D.a2dp_sink"

# è°ƒèŠ‚éŸ³é‡è®¾ç½®åˆ°30%
pactl set-sink-volume bluez_sink.11_02_03_06_13_5D.a2dp_sink 30%
```



# æ‰‹æœºâ•å¼€å‘æ¿â•è“ç‰™è€³æœºçš„è¿æ¥

> å‚è€ƒã€Š01ã€æ­£ç‚¹åŸå­ã€‘ATK-DLRK3568_Buildrootç³»ç»Ÿå¿«é€Ÿä½“éªŒæ‰‹å†ŒV1.3.pdfã€‹3.11ç« èŠ‚

## åˆå§‹åŒ–è“ç‰™

```bash
# æ­£ç‚¹åŸå­æä¾›çš„è“ç‰™åˆå§‹åŒ–çš„è„šæœ¬
/root/shell/bluetooth/bt_init.sh

bluetoothctl

power on # æ‰“å¼€ç”µæº
agent on # å¼€å¯ä»£ç†
discoverable on # å¼€å¯å¯è¢«æ£€æµ‹
scan on # å¼€å¯æ‰«æè®¾å¤‡
```

## æ‰«æå¾—åˆ°çš„è€³æœºçš„ä¿¡æ¯

```bash
[CHG] Device 11:02:03:06:13:5D EirData:
  0f 09 53 74 61 72 52 69 6e 67 20 55 6c 74 72 61  ..StarRing Ultra
  13 03 00 10 0e 11 0f 11 0c 11 0b 11 1e 11 03 12  ................
  00 12 01 11 01 05 01 07 04 0d 04 04 24 00 00 00  ............$...
  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................

```

- å‘èµ·é…å¯¹

```
pair 11:02:03:06:13:5D
```

- è“ç‰™è€³æœºé…å¯¹æˆåŠŸ

![image-20260102152619506](.\assets\image-20260102152619506.png)

- è¿æ¥è“ç‰™è€³æœº

```bash
connect 11:02:03:06:13:5D
trust 11:02:03:06:13:5D

aplay /usr/share/sounds/test.wav   # æµ‹è¯•éŸ³é¢‘
paplay /usr/share/sounds/test.wav   # æµ‹è¯•éŸ³é¢‘

pactl list short sinks    # æ£€æŸ¥ PulseAudio æ˜¯å¦è¯†åˆ«è€³æœº

# è®¾ç½®è“ç‰™è€³æœºä¸ºé»˜è®¤ sink
pactl set-default-sink bluez_sink.11_02_03_06_13_5D.a2dp_sink   
```

> è€³æœº MAC: 11:02:03:06:13:5D (StarRing Ultra)
>
> Sink åå­—: bluez_sink.11_02_03_06_13_5D.a2dp_sink



## æ‰‹æœºè¿æ¥å¼€å‘æ¿

![image-20260102162156704](.\assets\image-20260102162156704.png)

![image-20260102154722829](.\assets\image-20260102154722829.png)

```bash

root@ATK-DLRK3568:/# pactl list short sources
0       alsa_output.1.stereo-fallback.monitor   module-alsa-card.c      s16le 2ch 8000Hz        SUSPENDED
1       alsa_input.1.stereo-fallback    module-alsa-card.c      s16le 2ch 8000Hz        SUSPENDED
2       alsa_output.2.HDMI__hw_rockchiphdmi__sink.monitor       module-alsa-card.c      s16le 2ch 44100Hz       SUSPENDED
3       alsa_output.0.HiFi__hw_rockchiprk809co__sink.monitor    module-alsa-card.c      s16le 2ch 48000Hz       SUSPENDED
4       alsa_input.0.HiFi__hw_rockchiprk809co__source   module-alsa-card.c      s16le 2ch 44100Hz       SUSPENDED
5       bluez_sink.11_02_03_06_13_5D.a2dp_sink.monitor  module-bluez5-device.c  s16le 2ch 44100Hz       SUSPENDED
6       bluez_source.3C_38_24_BF_48_EC.a2dp_source      module-bluez5-device.c  s16le 2ch 44100Hz       SUSPENDED
root@ATK-DLRK3568:/#

```

**è€³æœºç›¸å…³**ï¼š 5 bluez_sink.11_02_03_06_13_5D.a2dp_sink.monitor è¿™å°±æ˜¯è€³æœºçš„**monitor source**ï¼ˆsink çš„ç›‘å¬æºï¼‰ï¼Œå®ƒä»£è¡¨è€³æœºä½œä¸ºè¾“å‡ºè®¾å¤‡æ—¶äº§ç”Ÿçš„â€œåé¦ˆâ€é€šé“ã€‚è™½ç„¶ä¸»è¦ç”¨å®ƒä½œä¸º sinkï¼Œä½† monitor ä¹Ÿä¼šå‡ºç°åœ¨ sources åˆ—è¡¨é‡Œ

**æ‰‹æœºç›¸å…³**ï¼š 6 bluez_source.3C_38_24_BF_48_EC.a2dp_source è¿™æ­£æ˜¯æˆ‘çš„ Xiaomi 15 æ‰‹æœºä½œä¸º **A2DP Source**ï¼ˆéŸ³é¢‘å‘é€ç«¯ï¼‰ï¼Œå¼€å‘æ¿æ¥æ”¶åˆ°çš„æ‰‹æœºéŸ³é¢‘æºã€‚ å½“ä½ æ’­æ”¾éŸ³ä¹åï¼Œå®ƒä» SUSPENDED è‡ªåŠ¨æ¿€æ´»ï¼ˆå˜æˆ RUNNING æˆ– IDLEï¼‰ï¼ŒéŸ³é¢‘æµå°±é€šè¿‡ loopback æ¨¡å—å®æ—¶è½¬å‘åˆ°è€³æœºäº†

**æ‰‹æœºMACåœ°å€**ï¼š`3C:38:24:BF:48:EC`

## æœ€ç»ˆæ•ˆæœ

- æ‰‹æœºæ’­æ”¾çš„å£°éŸ³èƒ½å¤Ÿé€šè¿‡å¼€å‘æ¿ä¸­è½¬ä¼ è¾¾åˆ°è€³æœºï¼Œä½†æ˜¯æ‰‹æœºç«¯çš„è°ƒèŠ‚éŸ³é‡æ— æ•ˆ

- æ•´ä¸ªé…ç½®è¿‡ç¨‹è¿˜æ˜¯æ¯”è¾ƒé¡ºåˆ©ï¼Œé€šè¿‡ä»¥ä¸‹çš„å‘½ä»¤åœ¨å¼€å‘æ¿ä¸Šåˆ—å‡ºå½“å‰ PulseAudio æ­£åœ¨åŠ è½½çš„æ‰€æœ‰æ¨¡å—ï¼ˆmodulesï¼‰ï¼Œç„¶åä»ä¸­ç­›é€‰å‡ºåå­—é‡ŒåŒ…å« â€œswitchâ€ã€â€œbluetoothâ€ã€â€œstreamâ€ æˆ– â€œroleâ€ è¿™å››ä¸ªå…³é”®è¯çš„æ¨¡å—
- ç³»ç»Ÿé‡‡ç”¨ PulseAudio çš„ module-bluetooth-policyã€module-switch-on-port-available ç­‰æ¨¡å—å®ç°è“ç‰™è®¾å¤‡çš„è‡ªåŠ¨å‘ç°ã€profile åˆ‡æ¢å’ŒéŸ³é¢‘è·¯ç”±ã€‚æ‰‹æœº A2DP Source éŸ³é¢‘æµåœ¨æ£€æµ‹åˆ°è€³æœº A2DP Sink åè‡ªåŠ¨è·¯ç”±ï¼Œæ— éœ€é¢å¤– loopback é…ç½®ï¼Œå®ç°äº†ä½å»¶è¿ŸéŸ³ä¹ä¸­ç»§ä¸å¯¼èˆªè¯­éŸ³ä¼˜å…ˆæ’­æŠ¥

```bash

root@ATK-DLRK3568:/# pactl list modules short | grep -E "switch|bluetooth|stream|role"
1       module-stream-restore
4       module-switch-on-port-available
9       module-bluetooth-policy
10      module-bluetooth-discover
18      module-intended-roles
21      module-role-cork
```

## è§£å†³æ’­æ”¾éŸ³é¢‘çš„æ—¶å€™è“ç‰™æ—¥å¿—åˆ·å±

```bash
dmesg -n 4
```

- åˆ›å»ºå¼€æœºè‡ªå¯åŠ¨è„šæœ¬ç„¶åæ·»åŠ è¿›å»

```bash
vi /etc/init.d/S99wby_init       # æˆ‘çš„å¼€æœºè‡ªå¯åŠ¨è„šæœ¬
```

## è‡ªåŠ¨é‡è¿çš„æ•ˆæœ

**å…³äºè“ç‰™è€³æœºï¼š**åœ¨å¼€å‘æ¿æœªåšä»»ä½•ç¼–ç çš„æƒ…å†µä¸‹ï¼Œé‡å¯ä¹‹åï¼Œè“ç‰™è€³æœºå†å¼€æœºï¼Œåˆ™å¯ä»¥è‡ªåŠ¨è¿æ¥ï¼Œä½†æ˜¯**æ²¡æœ‰è‡ªåŠ¨è®¾ç½®è“ç‰™è€³æœºä¸ºé»˜è®¤éŸ³é¢‘è¾“å‡ºè®¾å¤‡**

```bash
# å¿«é€ŸæŸ¥çœ‹å½“å‰é»˜è®¤sink
pactl info | grep "Default Sink"

# è®¾ç½®è“ç‰™è€³æœºä¸ºé»˜è®¤éŸ³é¢‘è¾“å‡ºè®¾å¤‡
pactl set-default-sink bluez_sink.11_02_03_06_13_5D.a2dp_sink   
```

**å…³äºæ‰‹æœºï¼š**å½“æ‰‹æœºçš„è“ç‰™é‡å¯ï¼Œæ˜¯å¯ä»¥è‡ªåŠ¨è¿æ¥å¼€å‘æ¿ï¼ˆæ‰‹æœºâ¡ï¸å¼€å‘æ¿ï¼‰ï¼Œä½†æ˜¯**å¼€å‘æ¿é‡å¯æ— æ³•è‡ªåŠ¨é‡è¿**

### è®¾ç½®è“ç‰™è‡ªå¯åŠ¨

ç¼–è¾‘`/etc/init.d/S99wby_init`å°†æ­£ç‚¹åŸå­çš„**è“ç‰™åˆå§‹åŒ–è„šæœ¬**æ·»åŠ è¿›å»

ç„¶åé‡å¯ä¹‹åéªŒè¯æ˜¯å¦å¯åŠ¨

```bash
# æ£€æŸ¥è“ç‰™æ˜¯å¦åœ¨è¿è¡Œ
bluetoothctl show              # Powered: yes
```

### å½“æœ‰æ–°è¿æ¥åˆ°æ¥ï¼Œæ£€æµ‹éŸ³é¢‘è¾“å‡ºä¹‹åè®¾ç½®è¯¥è®¾å¤‡ä¸ºé»˜è®¤éŸ³é¢‘è¾“å‡ºè®¾å¤‡

```bash
# æ·»åŠ è‡ªåŠ¨æ£€æµ‹çš„è„šæœ¬
vi /root/auto_set_default_sink.sh

# æ·»åŠ è¯¥è„šæœ¬çš„è¿è¡Œ
/etc/init.d/S99wby_init
```

````bash
#!/bin/sh
# /root/auto_set_default_sink.sh
# Automatically set Bluetooth audio devices as default sink
# Improved version with better detection and retry logic

LOG_FILE="/var/log/bt_audio_sink.log"
LOCK_FILE="/var/run/bt_sink_monitor.lock"

# Prevent multiple instances
if [ -f "$LOCK_FILE" ]; then
    echo "$(date): Script already running (PID: $(cat $LOCK_FILE))" >> "$LOG_FILE"
    exit 1
fi
echo $$$$ > "$LOCK_FILE"
trap "rm -f $LOCK_FILE; exit" INT TERM EXIT

# Log function
log() {
    echo "$(date '+%Y-%m-%d %H:%M:%S') - $1" >> "$LOG_FILE"
    echo "$1"  # Also print to console for debugging
}

# Wait for PulseAudio
wait_for_pulse() {
    local count=0
    while [ $count -lt 30 ]; do
        if pactl info >/dev/null 2>&1; then
            log "PulseAudio ready"
            return 0
        fi
        sleep 1
        count=$((count + 1))
    done
    log "ERROR: PulseAudio not ready after 30s"
    return 1
}

# Check if sink is Bluetooth A2DP
is_bluetooth_sink() {
    local sink="$1"
    # Match bluez_sink.MAC.a2dp_sink format
    if echo "$sink" | grep -E "^bluez_sink_[0-9a-f]{2}_[0-9a-f]{2}_[0-9a-f]{2}_[0-9a-f]{2}_[0-9a-f]{2}_[0-9a-f]{2}_a2dp_sink$" >/dev/null 2>&1; then
        return 0
    fi
    # Also match the colon format if it exists
    if echo "$sink" | grep -q "bluez_sink.*a2dp_sink"; then
        return 0
    fi
    return 1
}

# Set default sink with retry
set_default_sink() {
    local sink="$1"
    local max_retry=5
    local retry=0

    while [ $retry -lt $max_retry ]; do
        if pactl set-default-sink "$sink" 2>/dev/null; then
            log "SUCCESS: Set default sink to $sink"

            # Set volume to 70%
            pactl set-sink-volume "$sink" 70% 2>/dev/null
            pactl set-sink-mute "$sink" 0 2>/dev/null
            log "Volume set to 70% and unmuted"
            return 0
        else
            retry=$((retry + 1))
            log "Retry $retry/$max_retry: Failed to set $sink"
            sleep 2
        fi
    done

    log "ERROR: Failed to set $sink after $max_retry attempts"
    return 1
}

# Main monitoring using polling (more reliable than events)
monitor_by_polling() {
    log "Starting polling monitor"

    # Get initial sinks
    get_sinks() {
        pactl list short sinks 2>/dev/null | awk '{print $2}' | grep -E "bluez_sink.*a2dp_sink" | sort
    }

    prev_sinks=$(get_sinks)

    while true; do
        sleep 5  # Check every 5 seconds

        current_sinks=$(get_sinks)

        # Find new sinks
        new_sinks=$(comm -13 <(echo "$prev_sinks") <(echo "$current_sinks") 2>/dev/null)

        if [ -n "$new_sinks" ]; then
            log "New Bluetooth sinks detected: $new_sinks"

            for sink in $new_sinks; do
                # Wait for sink to be fully ready
                sleep 3
                set_default_sink "$sink"
            done

            prev_sinks="$current_sinks"
        fi
    done
}

# Alternative: Monitor udev events
monitor_udev() {
    log "Starting udev monitor"

    udevadm monitor --subsystem-match=bluetooth --environment | while read -r line; do
        if echo "$line" | grep -q "ACTION=add"; then
            log "Bluetooth device added via udev"
            sleep 4  # Wait for PulseAudio registration

            # Check for new Bluetooth sinks
            sinks=$(pactl list short sinks 2>/dev/null | grep "bluez_sink.*a2dp_sink" | awk '{print $2}')
            for sink in $sinks; do
                log "Found sink via udev: $sink"
                set_default_sink "$sink"
            done
        fi
    done
}

# Main execution
main() {
    log "=== Bluetooth Sink Monitor Started (Improved) ==="

    if ! wait_for_pulse; then
        exit 1
    fi

    # Start both monitoring methods
    monitor_by_polling &
    POLL_PID=$!

    monitor_udev &
    UDEV_PID=$!

    log "Monitor PIDs: poll=$POLL_PID, udev=$UDEV_PID"

    # Wait for any child to exit
    wait

    log "ERROR: Monitor process exited"
    exit 1
}

main



root@ATK-DLRK3568:/#
````

### ==å½“å¼€å‘æ¿é‡å¯ä¹‹åï¼Œå°è¯•å»è¿æ¥è€³æœºå’Œæ‰‹æœº==

> ä¸€ç›´ä¼šæŠ¥é”™â•å£°éŸ³å¡é¡¿ï¼Œå…ˆä¸å°è¯•äº†
>
> ä¸»åŠ¨è¿æ¥/å¹¿æ’­macåœ°å€è¢«åŠ¨è¿æ¥ï¼Œéƒ½ä¸è¡Œ

```bash
vi /root/bt_connect_hub.sh
rm -f /root/bt_connect_hub.sh
chmod +x /root/bt_connect_hub.sh


vi /root/testc.sh
rm -f /root/testc.sh
chmod +x /root/testc.sh
/root/testc.sh

bluetoothctl connect 3C:38:24:BF:48:EC
```

```bash
#!/bin/sh
# è„‰å†²å”¤é†’ç‰ˆ

log() { echo "$(date '+%H:%M:%S') - $1"; }

# è®¾ç½® CPU æ€§èƒ½æ¨¡å¼ï¼Œç¡®ä¿ UART æœ‰è¶³å¤Ÿçš„å¤„ç†ä¼˜å…ˆçº§
echo performance > /sys/devices/system/cpu/cpufreq/policy0/scaling_governor

# å¼€å¯å¹¿æ’­
bluetoothctl discoverable on
bluetoothctl pairable on

# è·å–é…å¯¹åˆ—è¡¨å¹¶ä»…å‘èµ·ä¸€æ¬¡å”¤é†’
PAIRED=$(bluetoothctl paired-devices | awk '{print $2}')
for mac in $PAIRED; do
    if ! bluetoothctl info "$mac" | grep -q "Connected: yes"; then
        log "æ­£åœ¨å°è¯•å”¤é†’: $mac"
        # ä¸¥æ ¼é™åˆ¶è¿æ¥æŒ‡ä»¤çš„å­˜æ´»æ—¶é—´ï¼Œé˜²æ­¢å…¶åœ¨åå°ä¸éŸ³é¢‘æµç«äº‰ UART æ€»çº¿
        timeout 5s bluetoothctl connect "$mac" >/dev/null 2>&1 & 
        sleep 2
    fi
done

# ä¿æŒ 30 ç§’å¹¿æ’­åé€€å‡ºï¼Œè®©ç³»ç»Ÿå›å½’çº¯å‡€çš„éŸ³é¢‘ä¼ è¾“çŠ¶æ€
sleep 30
bluetoothctl discoverable off
log "è¿æ¥å¼•å¯¼ä»»åŠ¡ç»“æŸ"
```



# æ‰‹æœºâ•å¼€å‘æ¿â•è“ç‰™è€³æœºçš„è¿æ¥ï¼ˆå¼€å‘æ¿ä½œä¸ºç»å¯¹ä¸»æœºï¼‰

æˆ‘æœ¬ä»¥ä¸ºä¸Šè¿°çš„è¿æ¥æ˜¯æ‰‹æœºï¼ˆä¸»æœºï¼‰â¡ï¸å¼€å‘æ¿ï¼ˆä¸»æœº/ä»æœºä¹‹é—´åˆ‡æ¢ï¼‰â¡ï¸è€³æœºï¼ˆä»æœºï¼‰çš„è®¾å®šï¼Œä½†æ˜¯å‘ç°å³ä½¿æ˜¯æ‰‹æœºå»ä¸»åŠ¨è¿æ¥çš„å¼€å‘æ¿ï¼Œæ‰‹æœºä¾ç„¶æ˜¯ä»æœºï¼ŒçŒœæµ‹æ˜¯å‘ç”Ÿäº†**è§’è‰²å¯¹æ¢**

https://www.tarlogic.com/bsam/controls/bluetooth-role-switch-authentication/

#  å°è¯•è§£å†³è“ç‰™è¿æ¥çš„éŸ³é¢‘ä¼ è¾“é—®é¢˜

> å‚è€ƒã€Š01ã€æ­£ç‚¹åŸå­ã€‘ATK-DLRK3568åµŒå…¥å¼Linuxç³»ç»Ÿå¼€å‘æ‰‹å†ŒV1.3.pdfã€‹
>
> å°è¯•è‡ªç¼–è¯‘é•œåƒæ¥è§£å†³

# å¼€å‘qtè½¦è½½ä»ªè¡¨ç›˜é¡¹ç›®

## Qtç¨‹åºéƒ¨ç½²ä¹‹åå¿«é€Ÿåˆ‡æ¢åˆ°EGLFSæ˜¾ç¤º

```bash
/opt/MotoDashboard/bin/MotoDashboard
```



```bash
vi /root/run_qt.sh

/root/run_qt.sh start

/root/run_qt.sh stop

/root/run_qt.sh restart
```



## æŒ‰é”®æ§åˆ¶

```kotlin
Item {
        focus: true // å¿…é¡»è®¾ç½®
        anchors.fill: parent
        Keys.enabled: true

        Keys.onPressed: {
            console.log("Key Pressed:", event.key)
            var currentName = stackView.currentItem ? stackView.currentItem.objectName : ""

            switch (event.key) {
                // 1. MENU: å¾ªç¯åˆ‡æ¢ç•Œé¢
                case 16777436:
                    console.log("Menu!!!")
                    cyclePage()
                    event.accepted = true
                    break

                // 2. ESC/Back: è¿”å›ä¸Šä¸€çº§
                case 16777216:
                    if (stackView.depth > 1) {
                        stackView.pop()
                    }
                    event.accepted = true
                    break

                // 3. V+: éŸ³é‡åŠ  OR å¼€å§‹æ‰«æ
                case 16777328:
                    if (currentName === "bluetooth") {
                        // å¦‚æœåœ¨è“ç‰™ç•Œé¢ï¼Œè°ƒç”¨è¯¥ç•Œé¢çš„ startScanning æ–¹æ³•
                        if (stackView.currentItem.startScanning) {
                            stackView.currentItem.startScanning()
                        }
                    } else {
                        // å…¶ä»–ç•Œé¢è°ƒèŠ‚éŸ³é‡
                        changeVolume(5)
                    }
                    event.accepted = true
                    break

                // 4. V-: éŸ³é‡å‡ OR åœæ­¢æ‰«æ
                case 16777330:
                    if (currentName === "bluetooth") {
                        // å¦‚æœåœ¨è“ç‰™ç•Œé¢ï¼Œè°ƒç”¨è¯¥ç•Œé¢çš„ stopScanning æ–¹æ³•
                        if (stackView.currentItem.stopScanning) {
                            stackView.currentItem.stopScanning()
                        }
                    } else {
                        // å…¶ä»–ç•Œé¢è°ƒèŠ‚éŸ³é‡
                        changeVolume(-5)
                    }
                    event.accepted = true
                    break
            }
        }
    }
```



## çœ‹ä¸åˆ°è°ƒè¯•ä¿¡æ¯

> é‡å¯å³å¯ï¼Œè„šæœ¬ä¸­é»˜è®¤æ˜¯åœ¨åå°è¿è¡Œï¼Œæ”¾åˆ°å‰å°å³å¯

```bash
killall MotoDashboard
/opt/MotoDashboard/bin/MotoDashboard
```

# å‡çº§å¼€å‘ç¯å¢ƒï¼šVSCODE â• SSH

## é…ç½®Ubuntuçš„ssh

https://zhuanlan.zhihu.com/p/681363165

```bash
# sshæœåŠ¡å¼€æœºè‡ªå¯åŠ¨
sudo systemctl enable ssh

# sshæœåŠ¡é»˜è®¤è¿è¡Œåœ¨ 22 ç«¯å£
sudo systemctl status ssh

# æˆ‘çš„é¡¹ç›®è·¯å¾„
/home/vboxuser/qt_projects/MotoDashboard

# ç”Ÿæˆå¯†é’¥å¯¹
ssh-keygen -t ed25519 -C "ubuntu-to-rk3568"

# å°†å…¬é’¥æ‹·è´åˆ°å¼€å‘æ¿ï¼ˆå¼€å‘æ¿çš„IPæ¯æ¬¡éƒ½ä¸ä¸€æ ·ï¼‰
ssh-copy-id root@10.84.181.22

# ç™»å½•å¼€å‘æ¿ï¼ˆå¼€å‘æ¿çš„IPæ¯æ¬¡éƒ½ä¸ä¸€æ ·ï¼‰
ssh root@10.84.181.22
```

## åˆ›å»º.vscode/task.json

```json
{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "1. qmake é…ç½®äº¤å‰ç¼–è¯‘",
            "type": "shell",
            "command": "cd build/RK3568 && qmake ../../MotoDashboard.pro",
            "group": "build",
            "problemMatcher": []
        },
        {
            "label": "2. ç¼–è¯‘ MotoDashboard",
            "type": "shell",
            "command": "cd build/RK3568 && make -j$(nproc)",
            "dependsOn": "1. qmake é…ç½®äº¤å‰ç¼–è¯‘",
            "group": {
                "kind": "build",
                "isDefault": true
            },
            "problemMatcher": ["$gcc"]
        },
        {
            "label": "3. Clean + Full Build",
            "type": "shell",
            "command": "cd build/RK3568 && make clean && qmake ../../MotoDashboard.pro && make -j$(nproc)",
            "group": "build",
            "problemMatcher": ["$gcc"]
        },
        {
            "label": "4. ä»…éƒ¨ç½²å¯æ‰§è¡Œæ–‡ä»¶",
            "type": "shell",
            "command": "scp build/RK3568/MotoDashboard root@10.84.181.22:/opt/MotoDashboard/bin/MotoDashboard",
            "dependsOn": "2. ç¼–è¯‘ MotoDashboard",
            "problemMatcher": []
        },
        {
            "label": "5. éƒ¨ç½²å¹¶è¿è¡Œ",
            "type": "shell",
            "command": "ssh root@10.84.181.22 'killall MotoDashboard || true; sleep 1' && scp build/RK3568/MotoDashboard root@10.84.181.22:/opt/MotoDashboard/bin/MotoDashboard && ssh root@10.84.181.22 'chmod +x /opt/MotoDashboard/bin/MotoDashboard && /opt/MotoDashboard/bin/MotoDashboard'",
            "dependsOn": "2. ç¼–è¯‘ MotoDashboard",
            "group": "test",
            "problemMatcher": []
        }
    ]
}
```

`Ctrl+Shift+M` é€‰æ‹©ä»»åŠ¡è¿›è¡Œç¼–è¯‘ï¼Œè¿™æ˜¯æˆ‘è‡ªå®šä¹‰çš„å¿«æ·é”®

æˆ–è€…`Ctrl+Shift+P`ç„¶åé€‰æ‹© `Tasks:Run Task`

## åˆ›å»º.vscode/c_cpp_properties.json

ç”¨äºcppé”™è¯¯æç¤º

## ä¹‹åæ¯æ¬¡å¼€å‘è¦åšçš„

```bash
# ubuntuç™»å½•å¼€å‘æ¿ï¼ˆå¼€å‘æ¿çš„IPæ¯æ¬¡éƒ½ä¸ä¸€æ ·ï¼‰
ssh root@10.84.181.22

# åœ¨å¼€å‘æ¿ä¸Šè·å–IP
ifconfig wlan0  
```

ç„¶åä¿®æ”¹.vscode/task.jsonæ–‡ä»¶é‡Œé¢çš„IPç›¸å…³çš„ä¸œè¥¿ï¼Œå°±å¯ä»¥å¼€å§‹å¼€å‘äº†

## ä¸è¶³

vscodeå¯¹äºcppçš„æç¤ºè¿˜è¡Œï¼Œä½†æ˜¯å¯¹äºqmlçš„é”™è¯¯æç¤ºå¾ˆå¼±

# å‡çº§å¼€å‘ç¯å¢ƒï¼šQtCreaterâ• SSH

https://doc.qt.io/qtcreator/creator-how-to-add-custom-compilers.html

https://doc.qt.io/qtcreator/creator-how-to-build-on-remote-linux.html

> å¤±è´¥äº†ï¼Œä»¥åæœ‰ç©ºå†ç ”ç©¶
